# Техническое задание по проекту: Построение ML-продукта для оптимизации классификации заявок на оплату для сервиса Repetit.ru 

## Заказчик  
Сервис по подбору репетиторов Repetit.ru 

## Описание проекта 
Сервис Repetit.ru работает с большим количеством заявок от клиентов с данными о предмете, желаемой стоимости, возрасте ученика, целью занятий и тд. К сожалению, 7 из 8 не доходят до оплаты, при этом обработка заявки консультантом увеличивает конверсию в оплату на 30%. 
Проблема в том, что консультантов не хватает на все заявки и получается, что чем больше заявок — тем меньше конверсия из заявки в оплату и консультанты тратят время на бесперспективные заявки. 

### Задача:
Разработать модель, которая по имеющейся информации о клиенте и заявке будет предсказывать вероятность оплаты заявки клиентом. 
Заказчик хочет понять, какие заявки будут оплачены, а какие нет, чтобы одни обрабатывать вручную консультантами, а другие нет. Оценка качества модели будет производиться с использованием precision и ROC-AUC. 

# Данные
1. Факт оплаты заявки можно проверять     
  a. в табл [main].[dbo].[orders] поле status_id = 6,13    
  b. все значения status_id:    
    - 1 Не обработана   
    - 2 Контактный телефон отдан клиенту 
    - 3 Проверена 
    - 4 Контактный телефон отдан преподавателю 
    - 5 Проведено первое занятие 
    - 6 Оплачена 
    - 7 Снята 
    - 8 Отложена 
    - 9 Договорились о занятиях 
    - 11 Созвонились 
    - 12 !!! Не оплачена !!! 
    - 13 Произведена оплата 
    - 14 Оплачена 25/50% 
    - 15 Подлежит оплате 
    - 16 Снята.    
        5,6,13,15
      
   c. для оплаты процента от каждого занятия можно по-другому: смотрим [main].[dbo].[lessons] и там поле amount_paid с суммой оплаты.      
2. enable_auto_assign и enable_assign в таблице suitable_teachers — доступен ли репетитор к работе или заблокирован (может ли репетитора назначить консультант и может ли он сам назначиться)      
3. creator_id - это айди студента или сотрудника создавшего заявку?     
  a. id сотрудника или клиента      
4. В таблице с желаемыми репетиторами уже отобраны из базы все подходящие репы под каждую заявку на момент ее подачи?     
  a. нет, желаемые репетиторы — это репетиторы, которых выбрал клиент самостоятельно из каталога. они могут быть не подходящие теоретически     

   # Описание данных
   #### Заявки (orders*.feather)

- order_date - дата создания 
- subject_id - предмет
- purpose - цель занятий
- lesson_price - цена
- lesson_duration - желаемая проодолжительность урока
- home_metro_id - ближайшее метро
- add_info - доп инфо
- start_date
- working_teacher_id
- status_id - оплачена ли заявка (значения 6 и 13 говорят о факте оплаты заявки)
- comments   
- amount_to_pay
- planned_lesson_number - клиент планирует N занятий
- first_lesson_date - дата 1 занятия
- coef - коэффициент
- creator_id - кто создал заявку (id сотрудника или клиента)
- pupil_category_new_id - возраст ученика
- lessons_per_week - занятий а неделю
- minimal_price
- teacher_sex - пол репетитора
- teacher_experience_from - опыт репетитора от
- teacher_experience_to- опыт репетитора до
- lesson_place_new - онлайн, у ученика, у учителя
- pupil_knowledgelvl -уровень знаний ученика
- teacher_age_from - желаемый возраст репеитора от
- teacher_age_to - желаемый возраст репеитора от
- chosen_teachers_only - не предлагать репетиторов кроме выбранных самостоятельно
- no_teachers_available - на заявку нет подходящих репов
- source_id - где создана заявка (какая часть сайта, не регион)
- original_order_id - дублем какой заявки является эта заявка
- client_id - айди клиента
- additional_status_id
- max_metro_distance - максимально готов ехать от метро
- estimated_fee 
- payment_date
- test_group - аб тесты
- is_display_to_teachers - хочет ли клиент получать отклики репетиторов

**Репетиторы (teacher_info.feather)**

- date_update
- reg_date
- birth_date
- teaching_start_date
- user_id - айди
- is_email_confirmed
- is_home_lessons
- is_external_lessons
- external_comments
- lesson_duration - продолжит урока
- lesson_cost - стоимость урока
- status_id
- status_relevant_date
- status_school_id
- status_college_id
- status_display
- russian_level_id
- home_country_id
- education
- information
- is_confirmed
- is_display - показывается в каталоге
- rating_id 
- rating - рейтинг
- comments
- rules_confirmed_date
- last_visited - послеждний визит
- is_pupils_needed - открыт для заявок
- is_cell_phone_confirmed
- effective_rating - какой-то еще рейтинг
- area_id
- registrar_id
- pupil_needed_date
- sex
- amount_to_pay - долг
- is_remote_lessons
- remote_comments
- show_on_map
- send_mailing
- send_suitable_orders
- rating_for_users - рейтинг 2
- rating_for_admin - рейтинг 3
- passport_id
- is_edited
- orders_allowed - разрешено назначать на заявки
- display_days
- verification_status_id
- is_individual
- partner_id
- star_rating - рейтинг 4
- rating_for_users_yesterday - рейтинг вчера
- review_num - отзывы
- relevance_date
- is_display_at_partners
- video_presentation_id - есть видеопрезентация
- status_institution_id
- Free_time_relevance_date

  #### Подходящие по фильтру репетиторы (suitable_teachers.feather)

- tteacher_id - id репетитора
- order_id - id заявки
- contact_result    
- enable_auto_assign - доступен ли репетитор к работе или заблокирован (может ли репетитора назначить консультант и может ли он сам назначиться) (значение известно на момент подачи заявки)
- enable_assign - доступен ли репетитор к работе или заблокирован (может ли репетитора назначить консультант и может ли он сам назначиться) (значение известно на момент подачи заявки)

#### Желаемые репетиторы (prefered_teachers_order_id.feather)  
Репетиторы, которых клиент выбрал клиент.
- tteacher_id - id репетитора
- order_id - id заявки    

# Целевые метрики
8. мы хотим получить результат, что 50-75% от общего объема заявок мы можем не обрабатывать, так как они не будут оплачены
9. мы хотим видеть топ 5-25% заявок, которым нужно отдать максимальный приоритет
10. мы толерантны к ошибке пресижн оплаченных заявок, то есть норм, если модель будет показывать больше заявок как хороших, чем на самом деле.
11. мы не толерантны к низкому пресижн неоплаченных заявок, то есть не хотим модель, которая относит потенциально оплаченные заявки к плохим заявкам.

Данные для 0 (неоплачено) и 1 (оплачено) классов. recall, например, для оплаченных заявок показывает процент предсказанных как оплаченные от всех истинно оплаченных заявок. f1-score это некий баланс между precision и recall. А support - кол-во наблюдений отнесенных к тому или иному классу.
   

